---
title: "Global"
author: "g9"
date: "3/10/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r libraries}
library(mice)
library(dplyr)
library(ggplot2)
library(naniar)
library(tidyr)
library(caret)
```


```{r data}
dfcom <- readRDS("complete_data.rds")
dfinc <- readRDS("incomplete_data_g9.rds")
dfimp_listwise <- dfinc

set.seed(3456)
train.index <- createDataPartition(dfinc$smoke, p = .7,
                                  list = FALSE,
                                  times = 1)
train.smoke <- dfinc[train.index,]
test.smoke <- dfinc[-train.index,]
```

## Data Exploration

## Model for regressing heart diff based on age, smoke, and BMI
```{r}
#Scientifically interesting model:
dfcom$hrtdif <- dfcom$active - dfcom$rest
dfimp_listwise$heartdif <- dfimp_listwise$active - dfimp_listwise$rest
scintcom <- lm(hrtdif ~ age + smoke + bmi, data = dfcom)
scintimp_listwise <- lm(heartdif ~ age + smoke + bmi, data = dfimp_listwise, na.action = )
summary(scintcom, fit.measures = "standard")
summary(scintimp_listwise, fit.measures = "standard")
pr <- predict(scintcom, test.smoke)
pr.nonNA <- pr
pr.nonNA[!is.na(pr.nonNA)] <- 1
pr.nonNA[is.na(pr.nonNA)] <- 0

test.nonNA <- test.smoke["smoke"]
test.nonNA[!is.na(test.nonNA)] <- 1
test.nonNA[is.na(test.nonNA)] <- 0
```
## Ad hoc

```{r}
miceoutMean <- mice(dfinc,
                method = ifelse(colnames(dfinc) == "smoke", "logreg", "mean"),
                m = 1,
                maxit = 1)
dfMeanimp <- complete(miceoutMean)

summary(dfMeanimp)
summary(dfinc)
summary(dfcom)

miceoutReg <- mice(dfinc,
                   method = ifelse(colnames(dfinc) == "smoke", "logreg", "norm.predict"),
                   m = 1,
                   maxit = 1)
dfRegimp <- complete(miceoutReg)

summary(dfRegimp)
summary(dfMeanimp)
```
```{r}

xyplot(miceoutMean, active + bmi + height + weight ~ age + rest)
xyplot(miceoutReg, active + bmi + height + weight ~ age + rest)
```
```{r}

modelCom <- lm(active ~ rest + bmi + sex + smoke + intensity, data = dfcom)
modelList <- lm(active ~ rest + bmi + sex + smoke + intensity, data = dfinc)
modelMean <- lm(active ~ rest + bmi + sex + smoke + intensity, data = dfMeanimp)
modelReg <- lm(active ~ rest + bmi + sex + smoke + intensity, data = dfRegimp)
summary(modelCom)
summary(modelList)
summary(modelMean)
summary(modelReg)
```

```{r}

dfactive <- data.frame(complete = dfcom$active,
                       listwise = dfinc$active,
                       meanimp = dfMeanimp$active,
                       regimp = dfRegimp$active)

dfbmi <- data.frame(complete = dfcom$bmi,
                    listwise = dfinc$bmi,
                    meanimp = dfMeanimp$bmi,
                    regimp = dfRegimp$bmi)

dfheight <- data.frame(complete = dfcom$height,
                      listwise = dfinc$height,
                      meanimp = dfMeanimp$height,
                      regimp = dfRegimp$height)

dfweight <- data.frame(complete = dfcom$weight,
                       listwise = dfinc$weight,
                       meanimp = dfMeanimp$weight,
                       regimp = dfRegimp$weight)


ggplot(gather(dfactive), aes(value)) + 
  geom_histogram(bins = 10) + 
  facet_wrap(~key, scales = 'free_x')

ggplot(gather(dfbmi), aes(value)) + 
  geom_histogram(bins = 10) + 
  facet_wrap(~key, scales = 'free_x')

ggplot(gather(dfheight), aes(value)) + 
  geom_histogram(bins = 10) + 
  facet_wrap(~key, scales = 'free_x')

ggplot(gather(dfweight), aes(value)) + 
  geom_histogram(bins = 10) + 
  facet_wrap(~key, scales = 'free_x')

```
```{r}

cactive <- c(dfcom$active,
                       dfinc$active,
                       dfMeanimp$active,
                       dfRegimp$active)
dfactive.names <- c()
dfactive.names[0:306] <- 'Complete'
dfactive.names[307:612] <- 'Listwise'
dfactive.names[613:918] <- 'Mean Imputation'
dfactive.names[919:1224] <- 'Reg Imp'

dfactive <- data.frame(active = cactive, names=dfactive.names)
ggplot(dfactive, aes(x=active, fill = names))+
   geom_histogram( color='#e9ecef', alpha=0.6, position='identity')

cbmi <- c(dfcom$bmi,
                    dfinc$bmi,
                    dfMeanimp$bmi,
                    dfRegimp$bmi)

dfbmi <- data.frame(bmi = cbmi, names = dfactive.names)
ggplot(dfbmi, aes(x=bmi, fill = names))+
   geom_histogram( color='#e9ecef', alpha=0.6, position='identity')

cheight <- c(dfcom$height,
                      dfinc$height,
                      dfMeanimp$height,
                      dfRegimp$height)
dfheight <- data.frame(height = cheight, names = dfactive.names)
ggplot(dfheight, aes(x=height, fill = names))+
   geom_histogram( color='#e9ecef', alpha=0.6, position='identity')


cweight <- c(dfcom$weight,dfinc$weight,dfMeanimp$weight,dfRegimp$weight)
dfweight <- data.frame(weight = cweight, names = dfactive.names)
ggplot(dfweight, aes(x=weight, fill = names))+
   geom_histogram( color='#e9ecef', alpha=0.6, position='identity')



```

```{r}

cactive <- c(dfcom$active,
                       dfinc$active,
                       dfRegimp$active)
dfactive.names <- c()
dfactive.names[0:306] <- 'Complete'
dfactive.names[307:612] <- 'Listwise'
dfactive.names[613:918] <- 'Reg Imp'

dfactive <- data.frame(active = cactive, names=dfactive.names)
ggplot(dfactive, aes(x=active, fill = names))+
   geom_histogram( color='#e9ecef', alpha=0.6, position='identity')

cbmi <- c(dfcom$bmi,
            dfinc$bmi,
            dfRegimp$bmi)

dfbmi <- data.frame(bmi = cbmi, names = dfactive.names)
ggplot(dfbmi, aes(x=bmi, fill = names))+
   geom_histogram( color='#e9ecef', alpha=0.6, position='identity')

cheight <- c(dfcom$height,
              dfinc$height,
              dfRegimp$height)
dfheight <- data.frame(height = cheight, names = dfactive.names)
ggplot(dfheight, aes(x=height, fill = names))+
   geom_histogram( color='#e9ecef', alpha=0.6, position='identity')


cweight <- c(dfcom$weight,dfinc$weight,dfRegimp$weight)
dfweight <- data.frame(weight = cweight, names = dfactive.names)
ggplot(dfweight, aes(x=weight, fill = names))+
   geom_histogram( color='#e9ecef', alpha=0.6, position='identity')

```

```{r}

df_missing_lowint <- dfinc[dfinc$intensity == "low",]
df_missing_medint <- dfinc[dfinc$intensity == "moderate",]
df_missing_hiint <- dfinc[dfinc$intensity == "high",]
vis_miss(df_missing_lowint)
md.pattern(df_missing_lowint)



md.pattern(df_missing_lowint, plot = FALSE)

pc <- md.pairs(dfinc)
pc
round(100 * pc$mr/(pc$mr+pc$mm))
round(100 * pc$rm/(pc$rm+pc$rr))

pl <- md.pairs(df_missing_lowint)
pl
round(100 * pl$mr/(pl$mr+pl$mm)) 
round(100 * pl$rm/(pl$rm+pl$rr))

pm <- md.pairs(df_missing_medint)
pm
round(100 * pm$mr/(pm$mr+pm$mm)) 
round(100 * pm$rm/(pm$rm+pm$rr))

ph <- md.pairs(df_missing_hiint)
ph
round(100 * ph$mr/(ph$mr+ph$mm))
round(100 * ph$rm/(ph$rm+ph$rr))
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
